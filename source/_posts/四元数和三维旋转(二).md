---
title: 四元数和三维旋转(二)
date: 2022-07-18 10:09:23
tags: Math
categories: Computer Graphics
math: true
---

## 四元数 ##

所有的四元数 $q \in \mathbb{H}$ 都可以写成下面这种形式：
$$
q = a + bi + cj + dk,(a,b,c,d \in \mathbb{R})
$$

其中
$$
i^2 = j^2 = k^2 = ijk = -1
$$

如果把上式称为四元数的**代数形式**，那么和复数类似，它也有对应的**向量形式一**：
$$
q = \begin{bmatrix}
a\\ b\\ c\\ d\\
\end{bmatrix}
$$

如果将四元数 $q$ 的实部和虚部分开，并用一个三维的向量来表示虚部，将它表示为标量和向量的有序对形式，那么四元数还可以表示为下述的**向量形式二**：
$$
q = [s, \pmb{v}], (\pmb{v} = \begin{bmatrix} x\\ y\\ z\\ \end{bmatrix},\quad s,x,y,z \in \mathbb{R})
$$

### 四元数的性质 ###

#### 四元数的模长 ####

仿照复数模长的定义，我们可以暂时将四元数 $q = a + bi + cj + dk$ 的模长定义为
$$
\lVert q \rVert = \sqrt{a^2 + b^2 + c^2 + d^2}
$$
如果用标量向量有序对的形式进行表示的话，$q = [s, \pmb{v}]$ 的模长为：
$$
\lVert q \rVert = \sqrt{s^2 + \lVert\pmb{v}\rVert^2} = \sqrt{s^2 + \pmb{v}\cdot\pmb{v}}
$$

#### 四元数的加减法 ####

与复数类似，四元数的加法只需要将分量相加就可以了，如果我们有两个四元数 $q_{1} = a + bi + cj + dk$，$q_{2} = e + fi + gj + hk$，那么它们的和为
$$
\begin{aligned}
q_{1} + q_{2} &= a + bi + cj + dk + e + fi + gj + hk\\
&= (a + e) + (b + f)i + (c + g)j + (d + h)k
\end{aligned}
$$

减法同理，将加号改为减号就可以了
$$
q_{1} - q_{2} = (a - e) + (b - f)i + (c - g)j + (d - h)k
$$

如果四元数是以标量向量有序对形式定义的，比如说 $q_{1} = [s, \pmb{v}]$，$q_{2} = [t, \pmb{u}]$，那么
$$
q_{1} \pm q_{2} = [s \pm t, \pmb{v}\pm\pmb{u}]
$$

#### 四元数的标量乘法 ####

如果我们有一个四元数 $q = a + bi + cj + dk$ 和一个标量 $s$，那么它们的乘积为：
$$
\begin{aligned}
sq &= s(a + bi + cj + dk)\\
&= sa + sbi + scj + sdk
\end{aligned}
$$

四元数与标量的乘法遵守交换律，也就是说 $sq = qs$

#### 四元数乘法 ####

四元数之间的乘法不遵守交换律，也就是说一般情况下 $q_{1}q_{2} \neq q_{2}q_{1}$。这也就有了左乘和右乘的区别，如果是 $q_{1}q_{2}$，我们就说"$q_{2}$ 左乘以 $q_{1}$"，如果是 $q_{2}q_{1}$，那我们就说"$q_{2}$ 右乘以 $q_{1}$"。除了交换律之外，结合律和分配律在四元数内都是成立的。

如果有两个四元数 $q_{1} = a + bi + cj + dk$ 和 $q_{2} = e + fi + gj + hk$，那么
$$
\begin{aligned}
q_{1}q_{2} &= (a + bi + cj + dk)(e + fi + gj + hk)\\
&= ae + afi + agj + ahk +\\
&\quad bei + bfi^2 + bgij + bhik +\\
&\quad cej + cfji + cgj^2 + chjk +\\
&\quad dek + dfki + dgkj + dhk^2
\end{aligned}
$$

由 $i^2 = j^2 = k^2 = ijk = -1$ 我们可以推导出 $jk = i$，$ij = k$，$ki = j$，$kj = -i$，$ji = -k$，$ik = -j$，于是我们可以得到：

![](/posts_image/Quaternion/Quaternion_7.png)

容易观察到交换律并不成立。利用上面的表格，我们可以对四元数之间的乘法进行归纳化简：
$$
\begin{aligned}
q_{1}q_{2}
&= ae + afi + agj + ahk +\\
&\quad bei + bfi^2 + bgij + bhik +\\
&\quad cej + cfji + cgj^2 + chjk +\\
&\quad dek + dfki + dgkj + dhk^2\\
&= (a\textcolor{red}{e} - b\textcolor{blue}{f} - c\textcolor{green}{g} - d\textcolor{orange}{h})+\\
&\quad (b\textcolor{red}{e} + a\textcolor{blue}{f} - d\textcolor{green}{g} + c\textcolor{orange}{h})i+\\
&\quad (c\textcolor{red}{e} + d\textcolor{blue}{f} + a\textcolor{green}{g} - b\textcolor{orange}{h})j+\\
&\quad (d\textcolor{red}{e} - c\textcolor{blue}{f} + b\textcolor{green}{g} + a\textcolor{orange}{h})k\\
\end{aligned}
$$

#### 矩阵形式 ####

可以看到，四元数的相乘其实也是一个线性组合，我们同样可以将它写成矩阵的形式：
$$
q_{1}q_{2} = 
\begin{bmatrix}
a&-b&-c&-d\\
b&a&-d&c\\
c&d&a&-b\\
d&-c&b&a\\
\end{bmatrix}
\begin{bmatrix}
\textcolor{red}{e}\\
\textcolor{blue}{f}\\
\textcolor{green}{g}\\
\textcolor{orange}{h}\\
\end{bmatrix}
$$

注意，这个矩阵所作出的变换等价于**左乘 $q_{1}$**。因为四元数不符合乘法交换律，所以**右乘 $q_{1}$**的变换是一个不同的矩阵，它可以使用完全相同的方法推导而得，下面这个矩阵所作出的变换等价于**右乘 $q_{1}$**

$$
q_{2}q_{1} = 
\begin{bmatrix}
a&-b&-c&-d\\
b&a&d&-c\\
c&-d&a&b\\
d&c&-b&a\\
\end{bmatrix}
\begin{bmatrix}
\textcolor{red}{e}\\
\textcolor{blue}{f}\\
\textcolor{green}{g}\\
\textcolor{orange}{h}\\
\end{bmatrix}
$$

#### Graßmann积 ####

重新整理之前的乘法结果：

$$
\begin{aligned}
q_{1}q_{2} &= (ae -(bf + cg + dh))+\\
&\quad(b\textcolor{red}{e} + \textcolor{blue}{a}f + ch - dg)i+\\
&\quad(c\textcolor{red}{e} + \textcolor{blue}{a}g + df - bh)j+\\
&\quad(d\textcolor{red}{e} + \textcolor{blue}{a}h + bg - cf)k\\
\end{aligned}
$$

如果令 $\pmb{v} = \begin{bmatrix}b\\ c\\ d\\ \end{bmatrix}$，$\pmb{u} = \begin{bmatrix}f\\ g\\ h\\ \end{bmatrix}$，那么

$$
\pmb{v}\cdot\pmb{u} = bf + cg + dh
$$
$$
\begin{aligned}
\pmb{v}\times\pmb{u} &= 
\begin{vmatrix}
\pmb{i}&\pmb{j}&\pmb{k}\\
b&c&d\\
f&g&h\\
\end{vmatrix}\\
&= (ch - dg)\pmb{i} - (bh - df)\pmb{j} + (bg - cf)\pmb{k}
\end{aligned}
$$

注意 $\pmb{v}\times\pmb{u}$ 的结果是一个向量，这里的 $\pmb{i}、\pmb{j}、\pmb{k}$ 是向量的基，如果使用标量向量有序对形式来表示，$q_{1}q_{2}$ 的结果可以用向量点乘和叉乘的形式表示出来

$$
q_{1}q_{2} = [ae - \pmb{v}\cdot\pmb{u}, a\pmb{u} + e\pmb{v} + \pmb{v}\times\pmb{u}]
$$

这个结果也被叫做 **Graßmann积**，一般来说：

{% note primary %}
**Theorem 7：Graßmann积**  
对任意四元数 $q_{1} = [s, \pmb{v}]$，$q_{2} = [t, \pmb{u}]$，$q_{1}q_{2}$ 的结果是
$$
q_{1}q_{2} = [st - \pmb{v}\cdot\pmb{u}, s\pmb{u} + t\pmb{v} + \pmb{v}\times\pmb{u}]
$$
{% endnote %}

#### 纯四元数 ####

实部为零，仅有虚部的四元数为**纯四元数**，即：
$$
q = [0, \pmb{v}]
$$

对于两个纯四元数 $q_{1} = [0, \pmb{v}]$，$q_{2} = [0, \pmb{u}]$，那么它们的乘积为：
$$
q_{1}q_{2} = [-\pmb{v}\cdot\pmb{u}, \pmb{v}\times\pmb{u}]
$$

#### 共轭 ####

四元数 $q = a + bi + cj + dk$ 的**共轭**为 $q^* = a - bi - cj - dk$。如果用标量向量有序对的形式来定义的话，$q = [s, \pmb{v}]$ 的共轭为 $q^* = [s, -\pmb{v}]$。共轭四元数的一个非常有用的性质就是
$$
\begin{aligned}
qq^* &= [s, \pmb{v}]\cdot[s, -\pmb{v}]\\
&= [s^2 - \pmb{v}\cdot(-\pmb{v}), s(-\pmb{v}) + s\pmb{v} + \pmb{v}\times(-\pmb{v})]\\
&= [s^2 + \pmb{v}\cdot\pmb{v}, 0]\\
&= s^2 + x^2 + y^2 + z^2\\
&= \lVert q \rVert^2
\end{aligned}
$$
结果是一个标量，正是四元数模长的平方。
$$
q^*q = (q^*)(q^*)^* = \lVert q^* \rVert^2 = \lVert q \rVert^2
$$
我们得到，$q^*q = qq^*$，这个特殊的乘法遵守交换律。

#### 逆 ####

因为四元数乘法不遵守交换律，我们不会将两个四元数相除写为 $\frac{p}{q}$ 的形式，取而代之的是将乘法的逆运算定义为 $pq^{-1}$ 或者 $q^{-1}p$，注意它们的结果一般是不同的。

其中，$q^{-1}$ 是 $q$ 的**逆**，我们规定
$$
qq^{-1} = q^{-1}q = 1\quad(q \neq 0)
$$

右乘 $q$ 的逆运算为右乘 $q^{-1}$，左乘 $q$ 的逆运算为左乘 $q^{-1}$。

利用共轭，我们可以进行如下推导：
$$
\begin{aligned}
qq^{-1} &= 1\\
q^*qq^{-1} &= q^*\\
\lVert q \rVert^2q^{-1} &= q^*\\
q^{-1} &= \frac{q^*}{\lVert q \rVert^2}\\
\end{aligned}
$$

四元数的逆就是它的共轭除以它模长的平方。如果 $\lVert q \rVert = 1$，那么它的逆就是它的共轭，此时称 $q$ 为一个**单位四元数**。

